# Async

![send_trait](./image2/async1.png)

![send_trait](./image2/async2.png)

std::future::Future; 这个future trait。

异步函数在执行时间比较长的IO操作的时候，不会阻塞当前线程，在等待的同时线程可以执行其它的任务。

```rust
use trpl::Html;

// main函数正常不能被标记为async。
// 异步代码需要一个异步运行时，main函数可以初始化运行时，但并不是运行时
#[tokio::main]
async fn main() {
    let url = "https://www.baidu.com/";
    let title = page_title(url).await.unwrap();

    println!("title: {title}"); // title: 百度一下，你就知道

}

// async说明这个函数是一个异步函数
async fn page_title(url: &str) -> Option<String> {
    let response = trpl::get(url).await;
    let response_text = response.text().await;

    Html::parse(&response_text)
        .select_first("title")
        .map(|title_element| title_element.inner_html())
}
```

`#[tokio::main]`  注解的原理是将main函数重写一下，重写成一个普通的main函数，但在main函数内部初始化一个异步运行时，类似如下main函数代码：
```rust
// 普通main函数，但在main函数内部嵌入了一个async block
fn main() {
    // 明确初始化一个异步运行时
    trpl::run(
        async {
            let url = "https://www.baidu.com/";
            let title = page_title(url).await.unwrap();

            println!("title: {title}"); // title: 百度一下，你就知道
        }
    )
}
```

没法真正的将main函数标记为 async 。